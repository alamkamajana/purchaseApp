<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Order</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/boxicons/css/boxicons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/bootstrap/css/bootstrap.css') }}"
          type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/sweetalert2/sweetalert2.css') }}"
          type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='/css/delivery/delivery.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='/css/tools/scanner.css') }}">
    <script src="{{ url_for('static', filename='/assets/bootstrap/js/bootstrap.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/jquery/jquery.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/sweetalert2/sweetalert2.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/quanggaJS/quanggaJS.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/html5-qrcode/js/html5-qrcode.min.js') }}"></script>

    <style>
        body {
            background-color: #f8f9fa; /* Light grey background */
            font-family: Arial, sans-serif; /* Default font */
            margin: 0;
            padding: 0;
        }

        .container {
            margin-top: 20px;
        }

        h1 {
            font-size: 2em;
            color: #343a40; /* Dark grey */
            margin-bottom: 20px;
        }

        .menu-container label {
            font-weight: bold;
            color: #495057; /* Slightly lighter grey */
        }

        input[type="text"], input[type="date"], textarea {
            margin-top: 10px;
            margin-bottom: 20px;
        }

        /* button {
            margin-top: 20px;
        } */

        .kembali-btn{
            padding-left: 4px;  
        }

        .btn-success {
            background-color: #28a745; /* Bootstrap green */
            border: none;
            /* padding: 10px 20px; */
            font-size: 1em;
            border-radius: 5px;
        }

        .btn-success:hover {
            background-color: #218838; /* Darker green on hover */
        }

        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }

        /* .menu-container {
            margin-bottom: 20px;
        } */

        .barcode-btn button{
            height:38px;
            margin-right: 16px;
        }

        .card{
            margin-bottom: 20px;
            padding : 16px;
        }

        .scanned-table td{
            background-color: #dfffef;
        }



        .unscanned-table td{
            background-color: #ffdfdf;
        }


        @media (min-width: 576px){
            .responsive-th{
                display:none;
            }

            .scanned-table thead{
                background-color: #bff8dc;
            }

            .unscanned-table thead{
                background-color: #f8bfbf;
            }
        }

        @media (max-width: 576px) {


            .event-container h1 {
                font-size: 1.5em;
            }

            .event-container .btn {
                width: 100%;
            }

            

            .event-container .form-control {
                margin-bottom: 10px;
            }

            .event-container .table-responsive {
                border: 0;
            }

            .event-container table {
                width: 100%;
                margin-bottom: 20px;
            }

            .event-container thead, .event-container th {
                display: none;
            }

            .event-container tbody, .event-container td, .event-container tr {
                display: block;
                width: 100%;
            }

            /* .event-container tr {
                margin-bottom: 10px;
                border-bottom: 1px solid #ddd;
            } */

            .event-container td {
                display: flex;
                justify-content: space-between;
                padding: 10px;
                text-align: left;
            }

            /* .event-container td:before {
                content: attr(data-label);
                flex-basis: 50%;
                text-align: left;
                font-weight: bold;
                color: #495057;
            } */


            .event-container td {
                width: 40%;
                box-sizing: border-box;
                display: inline-block;
            }

            .event-container tr{
                margin-bottom: 16px;
            }

            .responsive-table {
                display: block;
            }

            .responsive-table th, .responsive-table thead {
                display: none;
            }

            .responsive-table tbody {
                display: flex;
                flex-wrap: wrap;
            }

            .responsive-table tr {
                display: flex;
                flex-wrap: wrap;
                width: 100%;
                margin-bottom: 10px;
            }

            .responsive-table td {
                width: 50%;
                box-sizing: border-box;
                display: flex;
                align-items: center;
                justify-content: right;
                text-align: end;
            }

            .responsive-table .responsive-th{
                justify-content: left;
            }

            .responsive-table .overflow-container {
                width: 50%;
                box-sizing: border-box;
                display: flex;
                overflow-x: auto;
                justify-content: left;
                white-space: nowrap;
            }



            .responsive-table td:last-child{
                width:100% ;
            }

            
            .responsive-table .total-price-container td{
                width:50% !important;
                justify-content: right !important;
            }

            .responsive-table .total-price-container td:first-child{
                
                justify-content: left !important;
            }

            .responsive-table td a, .responsive-table td button{
                width:100%;
            }

            .full-btn{
                width:100%;
            }

            .scanned-table td:first-child, .scanned-table td:nth-child(2){
                background-color: #bff8dc;
            }

            .unscanned-table td:first-child, .unscanned-table td:nth-child(2){
                background-color: #f8bfbf;
            }


        }






        .form-control:disabled{
            background-color: inherit;
            color: black;
            cursor: not-allowed;
            border: none !important;
            padding-left: 4px;
        }

        .form-floating{
            padding-left: 0;
            >.form-control:disabled~label::after, .form-floating>:disabled~label::after {
                background-color: inherit;
            }
            > label {
                padding-left: 0;
            }
        }

        .delivery-note{
            margin-bottom: 32px;
        }

        .note{
            margin-top: 8px;
            min-height : 100px;
            border-radius: 12px;
            background-color: #f5f5f5;
            overflow: hidden;
            color: dimgray;
            padding: 8px;
        }

        .tab-content{
            padding: 16px;
        }


    </style>
</head>
<body>
<div class="container">
    <div class="row text-center">
        <div class="col">
            <h1>Tambah Barang</h1>
            <img id="tripper-logo-black" width="250" height="59" src="{{ url_for('static', filename='/image/tripper_logo.png') }}" style="display:none;">
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col">
            <a href="/delivery/index?pe={{ DeliveryOrder.query.filter_by(id=do).first().purchase_event_id }}"
               class="btn btn-secondary full-btn kembali-btn"><i class='bx bx-chevron-left'></i> Kembali</a>
        </div>
        <div class="col text-end">
            <span><b><u>STATUS : {{delivery_order.status}}</u></b></span>
        </div>
        
    </div>
</div>
<div class="container">
    <div class="card">
        <div class="row">
            <div class="col">
                {% if delivery_order.status!="Confirm"%}
                <a href="/delivery/edit?do={{do}}&pe={{ DeliveryOrder.query.filter_by(id=do).first().purchase_event_id }}"
                    class="btn full-btn btn-primary">Ubah</a>
                {% endif %}
            </div>
            <div class="col">
                {% if order_line %}
                <button onclick="deliveryInfo()"
                    class="btn full-btn btn-success">Print</button>
                {% endif %}
                {% if delivery_order.status=="Confirm"%}
                <a href="/delivery/reset?do={{do}}"
                    class="btn full-btn btn-danger">Reset to Draft</a>
                {% endif %}
            </div>

        </div>
        <div class="row" style="margin: 24px; margin-top: 0;">
            <div id="do_id" style="display: none;">{{delivery_order.id}}</div>
            <div id="po_name" style="display: none">{{po_odoo.name}}</div>
            <div id="po_partner" style="display: none">{{po_odoo.partner_name}}</div>
            <div id="order_driver" style="display: none">{{delivery_order.driver}}</div>
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" class="form-control" id="order_name" value="{{delivery_order.name}}" disabled>
                <label class="control-label" for="">Surat Jalan#</label>
            </div>
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" class="form-control" id="event_name" value="{{purchase_event.name}}" disabled>
                <label class="control-label" for="">Purchase Event#</label>
            </div>
            
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" id="order_origin" class="form-control" value="{{delivery_order.origin}}" disabled>
                <label class="control-label" for="">Asal</label>

            </div>
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" id="order_destination" class="form-control" value="{{delivery_order.destination}}" disabled>
                <label class="control-label" for="">Tujuan</label>
    
            </div>
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" class="form-control" value="{{delivery_order.compute_total_qty}}" disabled>
                <label class="control-label" for="">Total Kuantitas</label>
    
            </div>
    
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" id="order_vehicle" class="form-control" value="{{delivery_order.vehicle_number}}" disabled>
                <label class="control-label" for="">Kendaraan</label>

            </div>

            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" id="order_date" class="form-control" value="{{delivery_order.sent_date}}" disabled>
                <label class="control-label" for="">Tanggal Kirim</label>
    
            </div>
            <div class="form-floating col-sm-12 col-lg-3">
                <input name="" id="received_date" class="form-control" value="{{delivery_order.received_date}}" disabled>
                <label class="control-label" for="">Tanggal Sampai</label>
    
            </div>
            
        </div>
        <div class="delivery-note">
            <div>
                <span>Note : </span>
            </div>
            <div class="note">
                <p>{{delivery_order.note}}</p>
            </div>
        </div>

    </div>
</div>
<div class="container">
    <div class="card" style="padding: 0;">
        <div class="tabs">
            <ul class="tab-links tab-container">
                <a href="#scanned" class="active" type="button" id="1-tab-btn">Sudah Scan</a>
                <a href="#unscanned" type="button" id="2-tab-btn">Belum Scan</a>


            </ul>
            <div class="tab-content active" id="scanned">
                <form action="/delivery/detail/add" method="post">
                    <input type="hidden" name="do" value="{{ do }}"/>
                    <div class="row menu-container text-left">
                        <div class="col col-6">
                            <label>Barcode</label>
                            <input type="text" id="barcode" class="form-control" name="barcode"/>
                        </div>
                        <div class="col col-6 barcode-btn">
                            <button type="button" class="btn btn-primary" onclick="startScan()" id="scan-barcode-btn" style="margin-top: 34px;"><i class="bx bx-scan"></i></button>
                            <button type="submit" class="btn btn-success" style="margin-top: 34px;">Tambah</button>
                        </div>
                        
                        <div class="modal fade" id="scannerModal" role="dialog">
                            <div class="modal-dialog">

                                <!-- Modal content-->
                                <div class="modal-content">
                                    <div class="modal-header">
                                                    
                                        <h5 class="modal-title">QR Scanner</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top:0" onclick="stopScan()">
                                            <span><i class='bx bx-x bx-md'></i></span>
                                        </button>
                                
                                </div>
                                    <div class="modal-body">
                                        <div style="width: 100%;" id="reader"></div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <!-- <div class="row mt-2">
                        <div class="col text-center">
                            <button type="submit" class="btn btn-success">Tambah</button>
                        </div>
                    </div> -->
                </form>
                <div class="row mt-1 responsive-table">
                    <input type="hidden" id="do" value="{{ do }}">
                    <table class="table table-hover scanned-table">
                        <thead>
                        <tr>
                            
                            <td> Order</td>
                            <td> Produk</td>
                            <td class="text-end"> Kuantitas</td>
                            <td> Barcode</td>
                            <td> Action</td>
                        </tr>
                        </thead>
                        <tbody id="do-list">
                        {% for order in order_line %}
                        <tr>
                            <td class="responsive-th">
                                <b>Order</b>
                            </td>
                            <td> {{ order.purchase_order.name }}</td>
                            <td style="display: none;" class="product-id">{{order.product_odoo_id}}</td>
                            
                            <td style="display: none;" class="product-farmer">{{order.product_odoo_id}}</td>
                            
                            
                            <td class="responsive-th">
                                <b>Produk</b>
                            </td>
                            <td class="product-name">

                                [{{ ProductOdoo.query.filter_by(id=order.product_odoo_id).first().default_code }}] {{ ProductOdoo.query.filter_by(id=order.product_odoo_id).first().name }}
                            </td>
                            <td class="responsive-th">
                                <b>Kuantitas</b>
                            </td>
                            <td class="text-end order-qty"> {{ order.qty }}</td>
                            <td class="responsive-th">
                                <b>Barcode</b>
                            </td>
                            <td> {{ order.barcode }}</td>
                            <!-- <td><a href="/delivery/detail/delete?order_line={{ order.id }}" class="btn btn-sm btn-danger"><i
                                    class="bx bxs-trash"></i></a>
                            </td> -->
                            <td>
                                <button type="button" class="btn btn-sm btn-danger" style="margin:0" onclick="deleteOrder({{order.id}})">
                                    <span><i class="bx bxs-trash"></i></i></span>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                    <div class="modal fade" id="deleteModal" role="dialog">
                        <div class="modal-dialog">
                    
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                    
                                    <h5 class="modal-title">Hapus Barang</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="margin-top:0" onclick="closeModal()">
                                        <span><i class='bx bx-x bx-md'></i></span>
                                    </button>
                    
                                </div>
                                <div class="modal-body">
                                    <span>Apakah anda yakin ingin menghapus barang ini?</span>
                                    <form method="get" action="/delivery/detail/delete">
                                        
                                    
                                    <input type="text" id="delete_order_line" class="form-control" name="order_line" hidden/>
                                </div>
                                <div class="modal-footer">
                                    <button class="btn btn-secondary" type="button" onclick="closeModal()">Batal</button>
                                    <button class="btn btn-danger" type="submit">Hapus</button>
                                    </form>
                                </div>
                            </div>
                    
                        </div>
                    </div>
                </div>
            </div>
            <div class="tab-content active" id="unscanned">
                <div class="row mt-1 responsive-table">
                    <input type="hidden" id="do" value="{{ do }}">
                    <table class="table table-hover unscanned-table">
                        <thead>
                        <tr>
                            
                            <td> Order</td>
                            <td> Produk</td>
                            <td class="text-end"> Kuantitas</td>
                            <td> Barcode</td>
                            
                        </tr>
                        </thead>
                        <tbody id="do-list">
                        {% for order in available_order_line %}
                        <tr>
                            <td class="responsive-th">
                                <b>Order</b>
                            </td>
                            <td> {{ order.purchase_order.name }}</td>
                            <td class="responsive-th">
                                <b>Produk</b>
                            </td>
                            <td>
                                [{{ ProductOdoo.query.filter_by(id=order.product_odoo_id).first().default_code }}] {{ ProductOdoo.query.filter_by(id=order.product_odoo_id).first().name }}
                            </td>
                            <td class="responsive-th">
                                <b>Kuantitas</b>
                            </td>
                            <td class="text-end"> {{ order.qty }}</td>
                            <td class="responsive-th">
                                <b>Barcode</b>
                            </td>
                            <td> {{ order.barcode }}</td>
                            <td class="responsive-th" style="display: none;">
                                <b></b>
                            </td>
                            <!-- <td><a href="/delivery/detail/delete?order_line={{ order.id }}" class="btn btn-sm btn-danger"><i
                                    class="bx bxs-trash"></i></a>
                            </td> -->
                            
                        </tr>
                        {% endfor %}

                        </tbody>
                    </table>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {

        // Hide all tab contents except the first one
        $('.tab-content').not(':first').hide();

        // Handle tab click event
        $('.tab-links a').click(function() {
            var tab_id = $(this).attr('href');

            // Remove the 'active' class from all tabs
            $('.tab-links a').removeClass('active');

            // Add the 'active' class to the clicked tab
            $(this).addClass('active');

            // Hide all tab contents
            $('.tab-content').hide();

            // Show the clicked tab content
            $(tab_id).show();
        });


    });


    var html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", {fps: 10, qrbox: 250});

    function startScan() {
        $('#scannerModal').modal('show');
        html5QrcodeScanner.render(
            function (decodedText) {
                document.getElementById('barcode').value = decodedText;

                // Stop scanning after successfully decoding a QR code
                html5QrcodeScanner.clear().then(_ => {

                    // the UI should be cleared here
                    $('.modal').modal('hide');
                }).catch(error => {
                    // Could not stop scanning for reasons specified in `error`.
                    // This conditions should ideally not happen.
                });
            },
            function (errorMessage) {

            }
        );
    }

    function deleteOrder(order_line){
        $('#deleteModal').modal('show');
        document.getElementById('delete_order_line').value = order_line
    }


    function stopScan() {
        html5QrcodeScanner.clear().then(_ => {

            // the UI should be cleared here
            $('.modal').modal('hide');
        }).catch(error => {
            // Could not stop scanning for reasons specified in `error`.
            // This conditions should ideally not happen.
        });

    }

    function closeModal(){
        $('.modal').modal('hide');
    }
</script>

<script src="{{ url_for('static', filename='/js/tools/print_delivery.js') }}"></script>


</body>
</html>
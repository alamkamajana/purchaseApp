<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delivery Order</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/boxicons/css/boxicons.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/bootstrap/css/bootstrap.css') }}"
          type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='/assets/sweetalert2/sweetalert2.css') }}"
          type="text/css">
    <link rel="stylesheet" href="{{ url_for('static', filename='/css/delivery/delivery.css') }}">
    <script src="{{ url_for('static', filename='/assets/bootstrap/js/bootstrap.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/jquery/jquery.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/sweetalert2/sweetalert2.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/quanggaJS/quanggaJS.js') }}"></script>
    <script src="{{ url_for('static', filename='/assets/html5-qrcode/js/html5-qrcode.min.js') }}"></script>

    <style>
        body {
            background-color: #f8f9fa; /* Light grey background */
            font-family: Arial, sans-serif; /* Default font */
            margin: 0;
            padding: 0;
        }

        .container {
            margin-top: 20px;
        }

        h1 {
            font-size: 2em;
            color: #343a40; /* Dark grey */
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
            color: #495057; /* Slightly lighter grey */
        }

        input[type="text"], input[type="date"], textarea {
            margin-top: 10px;
            margin-bottom: 20px;
        }

        button {
            margin-top: 20px;
        }

        .btn-success {
            background-color: #28a745; /* Bootstrap green */
            border: none;
            padding: 10px 20px;
            font-size: 1em;
            border-radius: 5px;
        }

        .btn-success:hover {
            background-color: #218838; /* Darker green on hover */
        }

        .table-hover tbody tr:hover {
            background-color: #f1f1f1;
        }

        .menu-container {
            margin-bottom: 20px;
        }

        @media (max-width: 576px) {
            h1 {
                font-size: 1.5em;
            }

            .btn {
                width: 100%;
            }

            .form-control {
                margin-bottom: 10px;
            }

            .table-responsive {
                border: 0;
            }

            table {
                width: 100%;
                margin-bottom: 20px;
            }

            thead {
                display: none;
            }

            tbody, td, tr {
                display: block;
                width: 100%;
            }

            tr {
                margin-bottom: 10px;
                border-bottom: 1px solid #ddd;
            }

            td {
                display: flex;
                justify-content: space-between;
                padding: 10px;
                text-align: right;
            }

            td:before {
                content: attr(data-label);
                flex-basis: 50%;
                text-align: left;
                font-weight: bold;
                color: #495057;
            }
        }

    </style>
</head>
<body>
<div class="container">
    <div class="row text-center">
        <div class="col">
            <h1>Add Goods </h1>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col">
            <a href="/delivery/index?pe={{ DeliveryOrder.query.filter_by(id=do).first().purchase_event_id }}"
               class="btn btn-warning"><i class="bx bx-arrow-back"></i></a>
        </div>
           <div class="col">
            <a href="/delivery/edit?do={{do}}&pe={{ DeliveryOrder.query.filter_by(id=do).first().purchase_event_id }}"
               class="btn btn-info">Edit</a>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col">
            <p>Delivery Order : {{delivery_order.name}}</p>
            <p>Destination : {{delivery_order.destination}}</p>
            <p>Date : {{delivery_order.date}}</p>
        </div>
        <div class="col">
            <p>Vehicle : {{delivery_order.vehicle_number}}</p>
            <p>Total Qty : {{delivery_order.compute_total_qty}}</p>
            <p>Note : {{delivery_order.note}}</p>
        </div>
    </div>
</div>
<div class="container">
    <form action="/delivery/detail/add" method="post">
        <input type="hidden" name="do" value="{{ do }}"/>
        <div class="row menu-container text-left">
            <div class="col">
                <label>Barcode</label>
                <input type="text" id="barcode" class="form-control" name="barcode"/>
            </div>
            <div class="col">
                <button type="button" class="btn btn-info" onclick="startScan()" id="scan-barcode-btn"><i class="bx bx-scan"></i></button>
            </div>
            <div class="modal fade" id="scannerModal" role="dialog">
                <div class="modal-dialog">

                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">

                            <h5 class="modal-title">QR Scanner</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                                    onclick="stopScan()">
                                <span><i class='bx bx-x bx-md'></i></span>
                            </button>

                        </div>
                        <div class="modal-body">
                            <div style="width: 100%;" id="reader"></div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="row mt-2">
            <div class="col text-center">
                <button type="submit" class="btn btn-success">Submit</button>
            </div>
        </div>
    </form>
    <div class="row mt-5">
        <input type="hidden" id="do" value="{{ do }}">
        <table class="table table-hover">
            <thead>
            <tr>
                <td>
                    DO
                </td>
                <td> Order</td>
                <td> Product</td>
                <td> Quantity</td>
                <td> Barcode</td>
                <td> Action</td>
            </tr>
            </thead>
            <tbody id="do-list">
            {% for order in order_line %}
            <tr>
                <td>{{ DeliveryOrder.query.filter_by(id=do).first().name }}</td>
                <td> {{ order.purchase_order.name }}</td>
                <td>
                    {{ ProductOdoo.query.filter_by(id=order.product_odoo_id).first().name }}
                </td>
                <td> {{ order.qty }}</td>
                <td> {{ order.barcode }}</td>
                <td><a href="/delivery/detail/delete?order_line={{ order.id }}" class="btn-sm btn-danger"><i
                        class="bx bxs-trash"></i></a>
                </td>
            </tr>
            {% endfor %}

            </tbody>
        </table>
    </div>
</div>

<script>
    var html5QrcodeScanner = new Html5QrcodeScanner(
        "reader", {fps: 10, qrbox: 250});

    function startScan() {
        $('#scannerModal').modal('show');
        html5QrcodeScanner.render(
            function (decodedText) {
                document.getElementById('barcode').value = decodedText;

                // Stop scanning after successfully decoding a QR code
                html5QrcodeScanner.clear().then(_ => {

                    // the UI should be cleared here
                    $('.modal').modal('hide');
                }).catch(error => {
                    // Could not stop scanning for reasons specified in `error`.
                    // This conditions should ideally not happen.
                });
            },
            function (errorMessage) {

            }
        );
    }


    function stopScan() {
        html5QrcodeScanner.clear().then(_ => {

            // the UI should be cleared here
            $('.modal').modal('hide');
        }).catch(error => {
            // Could not stop scanning for reasons specified in `error`.
            // This conditions should ideally not happen.
        });

    }
</script>


</body>
</html>
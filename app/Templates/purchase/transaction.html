{% extends 'base.html' %}
{% block title %}
    Transaction
{% endblock %}
{% block plugin %}


{% endblock %}

{% block header %}
    <b>Transaction</b>
{% endblock %}

{% block content %}
<span id="selected-menu" style="display: none;">transaction</span>

<div class="card">
    
    <div class="card-body">

        <form action="/purchase/transaction/add" method="post">
                <div class="row">
                        <div class="form-floating col-sm-12 col-lg">
                            <input name="" class="form-control" id="" value="{{event.name}}" disabled>
                            <label class="control-label" for="purchase-event">Purchase Event</label>
                            <input name="purchase-event" class="form-control" id="purchase-event" value="{{event.id}}" hidden>

                        </div>

                        <div class="form-floating col-sm-12 col-lg">
                            <input name="" class="form-control" id="" value="{{event.purchase_order_odoo.name}}" disabled>
                            <label class="control-label" for="purchase-order">Purchase Order</label>
                            <input name="purchase-order-odoo" class="form-control" id="purchase-order-odoo" value="{{event.purchase_order_odoo.id}}" hidden>
                            <input name="purchase-order" class="form-control" id="purchase-order" value="{{po.id}}" hidden>
                        </div>

                        <div class="form-floating col-sm-12 col-lg">
                            <input name="" class="form-control" id="" value="{{farmer.farmer_name}}" disabled>
                            <label class="control-label" for="farmer">Farmer</label>
                            <input name="farmer" class="form-control" id="farmer" value="{{farmer.id}}" hidden>

                        </div>
                        <div class="form-floating col-sm-12 col-lg">
                            <input name="" class="form-control" id="" value="{{po.status}}" disabled>
                            <label class="control-label" for="status">Status</label>
                        </div>
                </div>
                <div class="row">
                        <div class="form-floating col-sm-12 col-lg">
                            <select name="product"
                                    class="form-control selectpicker populateJSON selectpickerProduct"
                                    data-live-search="true"
                                    data-live-search-placeholder="Search..."
                                    id="product"
                            >
                                <option value="" selected="true">Search Product...</option>
                            </select>
                            <label class="control-label" for="product">Product</label>
                        </div>

                        <div class="form-floating col-6 col-sm-6 col-lg-3">
                            <input class="form-control" type="number" id="price-unit" name="price-unit" value="0" step="any">
                            <label class="control-label" for="price-unit">Price Unit</label>
                        </div>
                        <div class="form-floating col-6 col-sm-6 col-lg-3">
                            <input class="form-control" type="number" id="qty" name="qty" value="0">
                            <label class="control-label" for="qty">Quantity</label>
                        </div>
                </div>
                <div style="width:100%; display:flex; justify-content: flex-end; padding:20px;">
                    <div style="display: flex; align-items: center;">
                        <button type="submit" class="btn btn-primary">Add</button>
                    </div>
                </div>
        </form>


        <div class="event-container" >

            <table class="table event-table" style="width: 100%; margin-top: 32px;">
                <tr>
                    <th style="width: 5%;">
                        No
                    </th>
                    <th style="width: 12%;">
                        Product
                    </th>

                    <th style="width: 12%;">
                        Price Unit
                    </th>
                    <th style="width: 8%;">
                        Qty
                    </th>
                    <th style="width: 16%;">
                        Subtotal
                    </th>
                    <th style="width: 10%;">
                        Edit
                    </th>
                </tr>
                {% set total_value = 0 %}

                {% for transaction in transaction_list %}

                    <tr class="event-row">
                        <td>
                            {{loop.index}}
                        </td>
                        <td>
                            {{transaction.product_odoo.name}}
                        </td>
                        <td class="fund-column">
                            <div class="transaction-info{{transaction.id}}" id="price-info{{transaction.id}}">
                                {{ '{:,.2f}'.format(transaction.unit_price) }}
                            </div>
                            <div class="update-form transaction-info{{transaction.id}} hidden">
                                <input type="number" id="price-update{{transaction.id}}" name="price-unit" value="{{'%.2f' | format(transaction.unit_price)}}"  step="any">
                            </div>
                        </td>
                        <td class="fund-column">
                            <div class="transaction-info{{transaction.id}}" id="qty-info{{transaction.id}}">
                                {{ '{:,.0f}'.format(transaction.qty) }}
                            </div>
                            <div class="update-form transaction-info{{transaction.id}} hidden">
                                <input type="number" id="qty-update{{transaction.id}}" name="qty" value="{{'%.0f' | format(transaction.qty)}}">
                            </div>
                        </td>
                        <td>
                            <div id="subtotal-info{{transaction.id}}">

                                {{ '{:,.2f}'.format(transaction.subtotal) }}

                            </div>
                        </td>
                        <td>
                            <span class="event-id" style="display: none;">{{transaction.id}}</span>
                            <button onclick="editTransaction('{{transaction.id }}')" type="button" class="btn btn-secondary transaction-info{{transaction.id}}" id="test1-btn">
                                <span><i class='bx bxs-pencil'></i></span>
                            </button>
                            <button onclick="updateTransaction('{{ transaction.id }}')" type="button" class="btn btn-success transaction-info{{transaction.id}} hidden">
                                <span><i class='bx bx-check' ></i></span>
                            </button>
                            <button onclick="cancelUpdateTransaction('{{ transaction.id }}')" type="button" class="btn btn-danger transaction-info{{transaction.id}} hidden">
                                <span><i class='bx bx-x'></i></span>
                            </button>
                        </td>
                    </tr>

                {% endfor %}


                <tr>
                    <td colspan="4">
                        <b>Total Price</b>
                    </td>
                    <td>
                        <div id="total-price">
                            {{'{:,.2f}'.format(total_price)}}
                        </div>
                    </td>
                </tr>
            </table>
            <span id="pagination-link" class="hidden">/purchase/transaction?page=</span>
            <span id="current-page" class="hidden">{{page}}</span>
            <span id="total-page" class="hidden">{{total_pages}}</span>
            <div id="pagination"  style="width:100%; display:flex; justify-content: center;"></div>
        </div>
        <div style="width:100%; display:flex; justify-content: flex-end; padding:20px;">
            <div style="display: flex; align-items: center;">
                <button type="button" class="btn btn-primary" onclick="">Confirm</button>
            </div>
        </div>
    </div>
 
</div>

{% endblock %}

{% block script_plugin %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/event.css') }}">
{% endblock %}